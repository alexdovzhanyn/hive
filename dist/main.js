!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.AlexDovzhanynScreeps=r():e.AlexDovzhanynScreeps=r()}(this,(()=>(()=>{"use strict";var e={94:function(e,r,t){var a=this&&this.__createBinding||(Object.create?function(e,r,t,a){void 0===a&&(a=t);var o=Object.getOwnPropertyDescriptor(r,t);o&&!("get"in o?!r.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,a,o)}:function(e,r,t,a){void 0===a&&(a=t),e[a]=r[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&a(r,e,t);return o(r,e),r},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const s=i(t(432)),l=i(t(306)),u=i(t(711)),p=i(t(613)),y=n(t(152)),c=t(883),d=i(t(760));r.default=()=>{t.g.spawnCreep||(t.g.spawnCreep=y.attemptSpawnCreep);const e={[c.Role.Harvester]:[],[c.Role.Upgrader]:[],[c.Role.Defender]:[],[c.Role.Builder]:[],[c.Role.Missionary]:[]},r={harvester:s.default,upgrader:l.default,defender:u.default,builder:p.default,missionary:d.default};for(var a in Object.values(Game.creeps).forEach((t=>{e[t.memory.role].push(t),r[t.memory.role].run(t)})),Memory.creeps)Game.creeps[a]||delete Memory.creeps[a];y.default.spawn(e)}},722:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.captureFlaggedRoom=r.attackHostileCreeps=r.repairWalls=r.buildClosestContructionSite=r.getEnergyFromNearestEnergyContainer=r.depositInNearestEnergyContainer=r.upgradeController=r.repairNearbyStructures=r.harvestNearestSource=void 0;const t=(e,r)=>{e.memory.lastAnnouncement!=r&&(e.say(r),e.memory.lastAnnouncement=r)};var a;!function(e){e.Harvesting="#A4E4B8",e.Repairing="#D4B798",e.Depositing="#F4E19A",e.Building="#A3C1E0",e.Attacking="#EFA4A4"}(a||(a={}));const o={opacity:.4};r.harvestNearestSource=e=>{t(e,"Harvesting");const r=e.pos.findClosestByPath(FIND_SOURCES);return e.harvest(r)==ERR_NOT_IN_RANGE&&e.moveTo(r,{maxRooms:1,visualizePathStyle:Object.assign(Object.assign({},o),{stroke:a.Harvesting})}),!0},r.repairNearbyStructures=e=>{let r=!1;const n=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:({hits:e,hitsMax:r})=>e<r});return n&&(t(e,"Repairing"),r=!0,e.repair(n)==ERR_NOT_IN_RANGE&&e.moveTo(n,{maxRooms:1,visualizePathStyle:Object.assign(Object.assign({},o),{stroke:a.Repairing})})),r},r.upgradeController=e=>{e.upgradeController(e.room.controller)==ERR_NOT_IN_RANGE&&e.moveTo(e.room.controller)},r.depositInNearestEnergyContainer=e=>{let r=!1;const n=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>[STRUCTURE_EXTENSION,STRUCTURE_SPAWN,STRUCTURE_CONTAINER,STRUCTURE_TOWER].includes(e.structureType)&&e.energy<e.energyCapacity});return n?(t(e,"Depositing"),r=!0,e.transfer(n,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(n,{maxRooms:1,visualizePathStyle:Object.assign(Object.assign({},o),{stroke:a.Depositing})})):e.say("No available container for deposit"),r},r.getEnergyFromNearestEnergyContainer=e=>{let r=!1;const a=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:({structureType:e,energy:r=0})=>e==STRUCTURE_CONTAINER&&r>0});return a&&(t(e,"Get Energy"),r=!0,e.withdraw(a,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(a,{maxRooms:1})),r},r.buildClosestContructionSite=e=>{let r=!1;const n=e.pos.findClosestByPath(FIND_CONSTRUCTION_SITES);return n&&(t(e,"Building"),r=!0,e.build(n)==ERR_NOT_IN_RANGE&&e.moveTo(n,{maxRooms:1,visualizePathStyle:Object.assign(Object.assign({},o),{stroke:a.Building})})),r},r.repairWalls=e=>{let r=!1;const n=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:({hits:e,hitsMax:r,structureType:t})=>t==STRUCTURE_WALL&&e<1e4});return n&&(t(e,"Fixing Walls"),r=!0,e.repair(n)==ERR_NOT_IN_RANGE&&e.moveTo(n,{maxRooms:1,visualizePathStyle:Object.assign(Object.assign({},o),{stroke:a.Repairing})})),r},r.attackHostileCreeps=e=>{t(e,"Attacking!");const r=e.pos.findClosestByPath(FIND_HOSTILE_CREEPS);return e.attack(r)==ERR_NOT_IN_RANGE&&e.moveTo(r,{maxRooms:1,visualizePathStyle:Object.assign(Object.assign({},o),{stroke:a.Attacking})}),!0},r.captureFlaggedRoom=e=>{let r=!1;const t=Game.flags.CaptureRoom;if(t&&e.carry.energy==e.carryCapacity&&(r=!0,e.moveTo(t),e.pos==t.pos&&(t.remove(),e.memory.captureRoom=e.room.name)),e.memory.captureRoom){r=!0;const t=Game.rooms[e.memory.captureRoom].controller;e.claimController(t)==ERR_NOT_IN_RANGE?e.moveTo(t):e.memory.captureRoom=""}return r}},613:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getBlueprintForSpawnStrategy=void 0;const a=t(883),o=t(722),n=t(101),i={bodyParts:[WORK,CARRY,CARRY,MOVE,MOVE],name:"Builder",defaultMemory:{role:a.Role.Builder}};r.getBlueprintForSpawnStrategy=e=>({[n.SpawnStrategy.Tier1]:i,[n.SpawnStrategy.Tier2]:Object.assign(Object.assign({},i),{bodyParts:[...i.bodyParts,WORK,MOVE]})}[e]),r.default={run:function(e){if(e.memory.building&&0==e.carry.energy&&(e.memory.building=!1),e.memory.building||e.carry.energy!=e.carryCapacity||(e.memory.building=!0),e.memory.building){if((0,o.repairNearbyStructures)(e))return;if((0,o.buildClosestContructionSite)(e))return;(0,o.repairWalls)(e)}else{if((0,o.getEnergyFromNearestEnergyContainer)(e))return;if((0,o.harvestNearestSource)(e))return;if(e.carry.energy==e.carryCapacity){if((0,o.depositInNearestEnergyContainer)(e))return;(0,o.upgradeController)(e)}}}}},711:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getBlueprintForSpawnStrategy=void 0;const a=t(883),o=t(722),n=t(101),i={bodyParts:[WORK,CARRY,ATTACK,MOVE],name:"Defender",defaultMemory:{role:a.Role.Defender}};r.getBlueprintForSpawnStrategy=e=>({[n.SpawnStrategy.Tier1]:i,[n.SpawnStrategy.Tier2]:Object.assign(Object.assign({},i),{bodyParts:[...i.bodyParts,ATTACK,MOVE]})}[e]),r.default={run:function(e){e.room.find(FIND_HOSTILE_CREEPS).length>0&&e.carry.energy>e.carryCapacity/5?(0,o.attackHostileCreeps)(e):0==e.room.find(FIND_HOSTILE_CREEPS).length&&1==e.memory.canUpgrade?(e.upgradeController(e.room.controller)==ERR_NOT_IN_RANGE&&e.memory.canUpgrade&&e.moveTo(e.room.controller),e.carry.energy<1&&(e.memory.canUpgrade=!1)):((0,o.harvestNearestSource)(e),e.carry.energy==e.carryCapacity&&(e.say("Upgrading"),e.memory.canUpgrade=!0))}}},432:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getBlueprintForSpawnStrategy=void 0;const a=t(883),o=t(722),n=t(101),i={bodyParts:[WORK,WORK,CARRY,MOVE],name:"Harvester",defaultMemory:{role:a.Role.Harvester}};r.getBlueprintForSpawnStrategy=e=>({[n.SpawnStrategy.Tier1]:i,[n.SpawnStrategy.Tier2]:Object.assign(Object.assign({},i),{bodyParts:[...i.bodyParts,WORK,MOVE]})}[e]),r.default={run:function(e){e.carry.energy<e.carryCapacity?(0,o.harvestNearestSource)(e):(0,o.depositInNearestEnergyContainer)(e)}}},760:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getBlueprintForSpawnStrategy=void 0;const a=t(883),o=t(722),n={bodyParts:[MOVE,MOVE,MOVE,CLAIM,CARRY,CARRY,WORK],name:"Missionary",defaultMemory:{role:a.Role.Missionary}};r.getBlueprintForSpawnStrategy=()=>n,r.default={run:e=>{o.captureFlaggedRoom||(0,o.harvestNearestSource)(e)}}},306:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getBlueprintForSpawnStrategy=void 0;const a=t(883),o=t(722),n=t(101),i={bodyParts:[WORK,CARRY,CARRY,MOVE,MOVE],name:"Upgrader",defaultMemory:{role:a.Role.Upgrader}};r.getBlueprintForSpawnStrategy=e=>({[n.SpawnStrategy.Tier1]:i,[n.SpawnStrategy.Tier2]:Object.assign(Object.assign({},i),{bodyParts:[...i.bodyParts,WORK,MOVE]})}[e]),r.default={run:function(e){e.memory.upgrading&&0==e.carry.energy&&(e.memory.upgrading=!1,e.say("harvesting")),e.memory.upgrading||e.carry.energy!=e.carryCapacity||(e.memory.upgrading=!0,e.say("upgrading")),e.memory.upgrading?(0,o.upgradeController)(e):(0,o.harvestNearestSource)(e)}}},152:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.attemptSpawnCreep=void 0;const a=t(432),o=t(613),n=t(711),i=t(306),s=t(760),l=t(883),u=t(101),p={[l.Role.Harvester]:a.getBlueprintForSpawnStrategy,[l.Role.Builder]:o.getBlueprintForSpawnStrategy,[l.Role.Defender]:n.getBlueprintForSpawnStrategy,[l.Role.Upgrader]:i.getBlueprintForSpawnStrategy,[l.Role.Missionary]:s.getBlueprintForSpawnStrategy},y=[l.Role.Harvester,l.Role.Builder,l.Role.Upgrader,l.Role.Defender];r.attemptSpawnCreep=(e,r)=>{const{bodyParts:t,name:a,defaultMemory:o}=p[e](r),n=Game.spawns.Spawn1.room.find(FIND_MY_STRUCTURES,{filter:{structureType:STRUCTURE_EXTENSION}});n.push(Game.spawns.Spawn1);const i={memory:o,energyStructures:n};if(Game.spawns.Spawn1.spawnCreep(t,a+Math.floor(100*Math.random()),Object.assign(Object.assign({},i),{dryRun:!0}))!=OK)return;const s=Game.spawns.Spawn1.spawnCreep(t,a+Math.floor(100*Math.random()),i);s!=OK&&console.log(`Couldn't spawn creep: ${s}`)};const c=e=>{const t={harvester:3,builder:2,defender:2,upgrader:2};let a=!0;for(const o of y)if(e[o].length<t[o])return a=!1,(0,r.attemptSpawnCreep)(o,u.SpawnStrategy.Tier1);a&&(0,r.attemptSpawnCreep)(l.Role.Builder,u.SpawnStrategy.Tier1)},d={[u.SpawnStrategy.Tier1]:c,[u.SpawnStrategy.Tier2]:e=>{const t={harvester:5,builder:3,defender:3,upgrader:3};let a=!0;for(const o of y)if(e[o].length<t[o])return a=!1,(0,r.attemptSpawnCreep)(o,u.SpawnStrategy.Tier2);a&&(0,r.attemptSpawnCreep)(l.Role.Builder,u.SpawnStrategy.Tier2)}};r.default={spawn:e=>{if(!Memory.allowAutoSpawn||Game.spawns.Spawn1.spawning)return;if(Object.keys(Game.creeps).length<3)return c(e);let r=Game.spawns.Spawn1.room.controller.level,t=d[r];for(;!t;){if(r--,0==r){t=c;break}t=d[r]}t(e)}}},927:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.loop=void 0;var o=t(94);Object.defineProperty(r,"loop",{enumerable:!0,get:function(){return a(o).default}})},883:(e,r)=>{var t;Object.defineProperty(r,"__esModule",{value:!0}),r.Role=void 0,(t=r.Role||(r.Role={})).Harvester="harvester",t.Builder="builder",t.Upgrader="upgrader",t.Defender="defender",t.Missionary="missionary"},101:(e,r)=>{var t;Object.defineProperty(r,"__esModule",{value:!0}),r.SpawnStrategy=void 0,(t=r.SpawnStrategy||(r.SpawnStrategy={}))[t.Tier1=0]="Tier1",t[t.Tier2=1]="Tier2",t[t.Tier3=2]="Tier3"}},r={};function t(a){var o=r[a];if(void 0!==o)return o.exports;var n=r[a]={exports:{}};return e[a].call(n.exports,n,n.exports,t),n.exports}return t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t(927)})()));